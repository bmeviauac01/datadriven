<!DOCTYPE html><html lang="en" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="István Albert, Tibor Tóth">
      
      
        <link rel="canonical" href="https://bmeviauac01.github.io/datadriven/en/lecture-notes/di/">
      
      
        <link rel="prev" href="../SQL_Cheat_Sheet/">
      
      
        <link rel="next" href="../async/">
      
      
      <link rel="icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.9">
    
    
      
        <title>Dependency Injection ASP.NET Core environment - BMEVIAUAC01 Data-driven systems</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.78cf6014.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/timeago.css">
    
      <link rel="stylesheet" href="../../extra-material-theme.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="aut" data-md-color-primary="aut" data-md-color-accent="red">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dependency-injection-aspnet-core-environment" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="BMEVIAUAC01 Data-driven systems" class="md-header__button md-logo" aria-label="BMEVIAUAC01 Data-driven systems" data-md-component="logo">
      
  <img src="../../img/logo-bme-aut.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BMEVIAUAC01 Data-driven systems
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Dependency Injection ASP.NET Core environment
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="aut" data-md-color-primary="aut" data-md-color-accent="red" aria-label="Váltás sötét témára" type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Váltás sötét témára" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"></path></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent="indigo" aria-label="Váltás világos témára" type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Váltás világos témára" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"></path></svg>
      </label>
    
  
</form>
      
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"></path></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="https://bmeviauac01.github.io/datadriven/en/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="https://bmeviauac01.github.io/datadriven/hu/" hreflang="hu" class="md-select__link">
              Magyar
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/bmeviauac01/datadriven" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
  </div>
  <div class="md-source__repository">
    bmeviauac01/datadriven
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Data-driven systems

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../db/" class="md-tabs__link">
          
  
  Database

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../architecture/" class="md-tabs__link">
          
  
  Lecture notes

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../seminar/transactions/" class="md-tabs__link">
          
  
  Seminars

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../homework/" class="md-tabs__link">
          
  
  Homework

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="BMEVIAUAC01 Data-driven systems" class="md-nav__button md-logo" aria-label="BMEVIAUAC01 Data-driven systems" data-md-component="logo">
      
  <img src="../../img/logo-bme-aut.png" alt="logo">

    </a>
    BMEVIAUAC01 Data-driven systems
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/bmeviauac01/datadriven" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
  </div>
  <div class="md-source__repository">
    bmeviauac01/datadriven
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data-driven systems
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2">
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Database
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Database
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../db/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sample database scheme
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../db/mssql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Microsoft SQL Server
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../db/mongodb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using MongoDB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://raw.githubusercontent.com/bmeviauac01/datadriven/master/overrides/db/mssql.sql" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sample database: mssql.sql
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://raw.githubusercontent.com/bmeviauac01/datadriven/master/overrides/db/mongo.js" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sample database: mongo.js
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Lecture notes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Lecture notes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data-driven systems and the three- or multi-tier architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../transactions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transactions in databases
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../mssql/sql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQL language, MSSQL platform-specific SQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../mssql/server-side-programming/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Microsoft SQL Server programming
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../adonet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ADO.NET data access
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../linq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LINQ: Language Integrated Query
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../ef/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Defining relationships in Entity Framework
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../mongodb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MongoDB basics, operations, and the MongoDB .NET Driver
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../SQL_Cheat_Sheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Query Syntax Cheat Sheet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Dependency Injection ASP.NET Core environment
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Dependency Injection ASP.NET Core environment
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#example-phase-1-service-class-with-wired-in-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Example phase 1 - service class with wired in dependencies
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-phase-2-service-class-with-manual-dependency-injection" class="md-nav__link">
    <span class="md-ellipsis">
      Example phase 2 - service class with manual dependency injection
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-phase-3-dependency-injection-based-on-net-dependency-injection" class="md-nav__link">
    <span class="md-ellipsis">
      Example phase 3 - dependency injection based on .NET Dependency Injection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example phase 3 - dependency injection based on .NET Dependency Injection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-register-step-registering-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      1) REGISTER step (registering dependencies)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-resolve-step-resolving-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      2) RESOLVE step (resolving dependencies)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2) RESOLVE step (resolving dependencies)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-basics" class="md-nav__link">
    <span class="md-ellipsis">
      The basics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#object-graph-resolution-autowiring" class="md-nav__link">
    <span class="md-ellipsis">
      Object graph resolution, autowiring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dependency-resolution-for-aspnet-web-api-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Dependency resolution  for ASP.NET Web API classes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#entity-framework-dbcontext-container-registration-and-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      Entity Framework DbContext container registration and resolution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-dependency-injection-registration-example" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced dependency injection registration example
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-topics" class="md-nav__link">
    <span class="md-ellipsis">
      Further topics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Further topics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dependency-injectionioc-containers-in-general" class="md-nav__link">
    <span class="md-ellipsis">
      Dependency Injection/IoC containers in general
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-service-locator-antipattern" class="md-nav__link">
    <span class="md-ellipsis">
      The Service Locator antipattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aspnet-core-framework-services" class="md-nav__link">
    <span class="md-ellipsis">
      Asp.Net Core framework services
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disposing-service-objects" class="md-nav__link">
    <span class="md-ellipsis">
      Disposing service objects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    <span class="md-ellipsis">
      Resources
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../async/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Asynchronous queries and DTOs (sample WebAPI application)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/bmeviauac01/rest-webapi-sample" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    REST and WebAPI sample app (GitHub)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/bmeviauac01/todoapi-di-sample" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ASP.NET Core DI sample app (GitHub)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/bmeviauac01/threelayered-aspnetcore-sample" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sample three-tier webapp (GitHub)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4">
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Seminars
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Seminars
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../seminar/transactions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transactions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../seminar/mssql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Microsoft SQL Server programming
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../seminar/ef/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Entity Framework
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../seminar/mongodb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MongoDB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../seminar/jpa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JPA &amp; Spring Data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../seminar/rest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    REST API &amp; ASP.NET Web API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5">
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Homework
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Homework
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Homework
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/mssql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. MSSQL server-side programming
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/ef/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Entity Framework
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/mongodb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. MongoDB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/rest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. REST API with Web API Technology
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/graphql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. GraphQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/GitHub/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Submitting your work (GitHub)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/GitHub-Actions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using GitHub Actions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/VisualStudio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install Visual Studio &amp; .NET SDK
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#example-phase-1-service-class-with-wired-in-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Example phase 1 - service class with wired in dependencies
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-phase-2-service-class-with-manual-dependency-injection" class="md-nav__link">
    <span class="md-ellipsis">
      Example phase 2 - service class with manual dependency injection
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-phase-3-dependency-injection-based-on-net-dependency-injection" class="md-nav__link">
    <span class="md-ellipsis">
      Example phase 3 - dependency injection based on .NET Dependency Injection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example phase 3 - dependency injection based on .NET Dependency Injection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-register-step-registering-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      1) REGISTER step (registering dependencies)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-resolve-step-resolving-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      2) RESOLVE step (resolving dependencies)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2) RESOLVE step (resolving dependencies)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-basics" class="md-nav__link">
    <span class="md-ellipsis">
      The basics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#object-graph-resolution-autowiring" class="md-nav__link">
    <span class="md-ellipsis">
      Object graph resolution, autowiring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dependency-resolution-for-aspnet-web-api-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Dependency resolution  for ASP.NET Web API classes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#entity-framework-dbcontext-container-registration-and-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      Entity Framework DbContext container registration and resolution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-dependency-injection-registration-example" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced dependency injection registration example
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-topics" class="md-nav__link">
    <span class="md-ellipsis">
      Further topics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Further topics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dependency-injectionioc-containers-in-general" class="md-nav__link">
    <span class="md-ellipsis">
      Dependency Injection/IoC containers in general
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-service-locator-antipattern" class="md-nav__link">
    <span class="md-ellipsis">
      The Service Locator antipattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aspnet-core-framework-services" class="md-nav__link">
    <span class="md-ellipsis">
      Asp.Net Core framework services
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disposing-service-objects" class="md-nav__link">
    <span class="md-ellipsis">
      Disposing service objects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    <span class="md-ellipsis">
      Resources
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/bmeviauac01/datadriven/blob/master/docs/hu/lecture-notes/di/index.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"></path></svg>
    </a>
  
  


<h1 id="dependency-injection-aspnet-core-environment">Dependency Injection ASP.NET Core environment<a class="headerlink" href="#dependency-injection-aspnet-core-environment" title="Permanent link">¶</a></h1>
<p>Zoltán Benedek, 11.19.2022</p>
<div class="admonition abstract">
<p class="admonition-title">Definition</p>
<p><strong>Dependency Injection</strong> (DI) is programming technique that makes a class independent of its dependencies. It's a key enabler for decomposing an application into loosely coupled components. More precisely: <strong>Dependency Injection is a mechanism to decouple the creation of dependency graphs for a class from its class definition</strong>.</p>
</div>
<p>Of course, the above definition is very abstract, and based on the short definition it's hard to understand what problems DI is trying to solve, and how DI is trying to solve them.</p>
<p>In the following chapters, we will use an example to put DI into context and to learn the basics of the DI related services build into ASP.NET Core.</p>
<p>Goals of DI</p>
<ul>
<li>Facilitated extensibility and maintainability</li>
<li>Improved unit testability</li>
<li>Facilitated code reuse</li>
</ul>
<div class="admonition example">
<p class="admonition-title">Sample application</p>
<p>The sample C# code is available here: <a href="https://github.com/bmeviauac01/todoapi-di-sample">https://github.com/bmeviauac01/todoapi-di-sample</a></p>
</div>
<h2 id="example-phase-1-service-class-with-wired-in-dependencies">Example phase 1 - service class with wired in dependencies<a class="headerlink" href="#example-phase-1-service-class-with-wired-in-dependencies" title="Permanent link">¶</a></h2>
<p>In this example, based on code snippets we look at parts of a to-do list (TODO) application that sends to-do item related email notifications. Note: The code is minimalistic for succinctness.</p>
<p>The "entry point" of our example is the <code>SendReminderIfNeeded</code> operation of the <code>ToDoService</code> class.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Class for managing todo items</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ToDoService</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">smtpAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"smtp.myserver.com"</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// It checks the todoItem object received as a parameter and sends an e-mail</span>
<span class="w">    </span><span class="c1">// notification about the to-do item to the contact person specified by the</span>
<span class="w">    </span><span class="c1">// todo item.</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SendReminderIfNeeded</span><span class="p">(</span><span class="n">TodoItem</span><span class="w"> </span><span class="n">todoItem</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">checkIfTodoReminderIsToBeSent</span><span class="p">(</span><span class="n">todoItem</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">NotificationService</span><span class="w"> </span><span class="n">notificationService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NotificationService</span><span class="p">(</span><span class="n">smtpAddress</span><span class="p">);</span>
<span class="w">            </span><span class="n">notificationService</span><span class="p">.</span><span class="n">SendEmailReminder</span><span class="p">(</span><span class="n">todoItem</span><span class="p">.</span><span class="n">LinkedContactId</span><span class="p">,</span><span class="w"> </span><span class="n">todoItem</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nf">checkIfTodoReminderIsToBeSent</span><span class="p">(</span><span class="n">TodoItem</span><span class="w"> </span><span class="n">todoItem</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">        </span><span class="cm">/* ... */</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">send</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// Entity class, encapsulates information about a todo task</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">TodoItem</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Database key</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Name/description of the task</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Indicates if the task has been completed</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">IsComplete</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// It's possible to assign a contact person to a task: -1 indicated no contact</span>
<span class="w">    </span><span class="c1">// person is assigned, otherwise the id of the contact person</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">LinkedContactId</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="m">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>In the code above (<code>ToDoService.SendReminderIfNeeded</code>) we see that the essential logic of sending an e-mail is to be found in the <code>NotificationService</code> class. Indeed, this class is at the center of our investigation. The following code snippet describes the code for the <code>NotificationService</code> class and its dependencies:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Class for sending notifications</span>
<span class="k">class</span><span class="w"> </span><span class="nc">NotificationService</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Dependencies of the class</span>
<span class="w">    </span><span class="n">EMailSender</span><span class="w"> </span><span class="n">_emailSender</span><span class="p">;</span>
<span class="w">    </span><span class="n">Logger</span><span class="w"> </span><span class="n">_logger</span><span class="p">;</span>
<span class="w">    </span><span class="n">ContactRepository</span><span class="w"> </span><span class="n">_contactRepository</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">NotificationService</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">smtpAddress</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Logger</span><span class="p">();</span>
<span class="w">        </span><span class="n">_emailSender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">EMailSender</span><span class="p">(</span><span class="n">_logger</span><span class="p">,</span><span class="w"> </span><span class="n">smtpAddress</span><span class="p">);</span>
<span class="w">        </span><span class="n">_contactRepository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ContactRepository</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Sends an email notification to the contact with the given ID</span>
<span class="w">    </span><span class="c1">// (contactId is a key in the Contacts table)</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SendEmailReminder</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">contactId</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">todoMessage</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="n">emailTo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_contactRepository</span><span class="p">.</span><span class="n">GetContactEMailAddress</span><span class="p">(</span><span class="n">contactId</span><span class="p">);</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="n">emailSubject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"TODO reminder"</span><span class="p">;</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="n">emailMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Reminder about the following todo item: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">todoMessage</span><span class="p">;</span>
<span class="w">        </span><span class="n">_emailSender</span><span class="p">.</span><span class="n">SendMail</span><span class="p">(</span><span class="n">emailTo</span><span class="p">,</span><span class="w"> </span><span class="n">emailSubject</span><span class="p">,</span><span class="w"> </span><span class="n">emailMessage</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Class supporting loggin</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Logger</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">LogInformation</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* ...*/</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">LogError</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* ...*/</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Class for sending e-mail notifications</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">EMailSender</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Logger</span><span class="w"> </span><span class="n">_logger</span><span class="p">;</span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="n">_smtpAddress</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">EMailSender</span><span class="p">(</span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">smtpAddress</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">logger</span><span class="p">;</span>
<span class="w">        </span><span class="n">_smtpAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">smtpAddress</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SendMail</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">subject</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">message</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_logger</span><span class="p">.</span><span class="n">LogInformation</span><span class="p">(</span><span class="s">$"Sending e-mail. To: {to} Subject: {subject} Body: {message}"</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Class for Contact entity persistence</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ContactRepository</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nf">GetContactEMailAddress</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">contactId</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p>A few general thoughts:</p>
<ul>
<li>The <code>NotificationService</code> class has several dependencies (<code>EMailSender</code>, <code>Logger</code>, <code>ContactRepository</code> classes) and it implements its services based on these dependency classes.</li>
<li>Dependency classes may have additional dependencies: <code>EMailSender</code> is a great example of this, it's dependent on the <code>Logger</code> class.</li>
<li>Note: <code>NotificationService</code>, <code>EMailSender</code>, <code>Logger</code>, <code>ContactRepository</code> classes are considered <strong>service classes</strong> because they contain business logic, not just encapsulate data, such as <code>TodoItem</code>.</li>
</ul>
<p>As we could see the <code>SendEmailReminder</code> operation is actually served by an object graph, where <code>NotificationService</code> is the root object, it has three dependencies, and its dependencies have further dependencies. The following figure illustrates this object graph:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/object-graph-1.svg" data-desc-position="bottom"><img alt="Object graph 1" src="images/object-graph-1.svg"></a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>One may ask why we considered <code>NotificationService</code>, and not <code>ToDoService</code> as the root object. Actually it just depends on our viewpoint: for simplicity we considered ToDoService as an entry point (a "client") for fulfilling a request, so that we have less classes to put under scrutiny. In a real life application we probably would consider <code>ToDoService</code> as part of the dependency graph as well.</p>
</div>
<p>Let's review the key features of this solution:</p>
<ul>
<li>The class instantiates its dependencies itself</li>
<li>Class depends on the specific type of its dependencies (and not on interfaces, "abstractions")</li>
</ul>
<p>This approach has a couple of significant and rather painful drawbacks:</p>
<ol>
<li><strong>Rigidity, lack of extensibility</strong>. <code>NotificationService</code> (without modification) cannot work with other mailing, logging and contact repository implementations (but only with the the wired in <code>EMailSender</code>, <code>Logger</code> and <code>ContactRepository</code> classes). That is, e.g. we can't use it with any other logging component, or e.g. use it with a contact repository that operates via a different data source/storage mechanism.</li>
<li><strong>Lack of unit testability</strong>. The <code>NotificationService</code> (without modification) cannot be unit tested. This would require replacing the <code>EMailSender</code>, <code>Logger</code> and <code>ContactRepository</code> dependencies with variants that provide fixed/expected responses  for a given input. Keep in mind that unit testing is about testing the behavior of a class independently from its dependencies. In our example, instead of using the database base ContactRepository, we would need a ContactRepository implementation that could serve requests very quickly from memory with values supporting the specific test cases.</li>
<li>There is one more subtle inconvenience that is hard to notice at first sight. In our example we had to provide the <code>smtpAddress</code> parameter to the <code>NotificationService</code> constructor, so that it can forward it to its <code>EMailSender</code> dependency. However, <code>smtpAddress</code> is a parameter completely meaningless for <code>NotificationService</code>, it has nothing to do with this piece of information. Unfortunately, we are forced to pass <code>smtpAddress</code> thorough <code>NotificationService</code>, as <code>NotificationService</code> is the class instantiating the <code>EMailSender</code> object. <strong>We could eliminate this by somehow instantiating <code>EMailSender</code> independently of <code>NotificationService</code></strong>.</li>
</ol>
<p>In the next steps, we redesign our solution so that we can eliminate most of the downsides of the current rigid approach.</p>
<h2 id="example-phase-2-service-class-with-manual-dependency-injection">Example phase 2 - service class with manual dependency injection<a class="headerlink" href="#example-phase-2-service-class-with-manual-dependency-injection" title="Permanent link">¶</a></h2>
<p>Redesign our former solution the functional requirements are unchanged.
The most important principles of transformation are the following:</p>
<ul>
<li><strong>Dependencies will be based on abstractions/interfaces</strong></li>
<li><strong>Classes will no longer instantiate their dependencies themselves</strong></li>
</ul>
<p>Let's jump right into the code of the improved solution and then analyze the differences:</p>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ToDoService</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">smtpAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"smtp.myserver.com"</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Checks the todoItem object received as a parameter and sends an e-mail</span>
<span class="w">    </span><span class="c1">// notification about the to-do item to the contact person specified by the</span>
<span class="w">    </span><span class="c1">// todo item.</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SendReminderIfNeeded</span><span class="p">(</span><span class="n">TodoItem</span><span class="w"> </span><span class="n">todoItem</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">checkIfTodoReminderIsToBeSent</span><span class="p">(</span><span class="n">todoItem</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Logger</span><span class="p">();</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">emailSender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">EMailSender</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span><span class="w"> </span><span class="n">smtpAddress</span><span class="p">);</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">contactRepository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ContactRepository</span><span class="p">();</span>

<span class="w">            </span><span class="n">NotificationService</span><span class="w"> </span><span class="n">notificationService</span>
<span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NotificationService</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span><span class="w"> </span><span class="n">emailSender</span><span class="p">,</span><span class="w"> </span><span class="n">contactRepository</span><span class="p">);</span>
<span class="w">            </span><span class="n">notificationService</span><span class="p">.</span><span class="n">SendEmailReminder</span><span class="p">(</span><span class="n">todoItem</span><span class="p">.</span><span class="n">LinkedContactId</span><span class="p">,</span>
<span class="w">                </span><span class="n">todoItem</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nf">checkIfTodoReminderIsToBeSent</span><span class="p">(</span><span class="n">TodoItem</span><span class="w"> </span><span class="n">todoItem</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">        </span><span class="cm">/* ... */</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">send</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Class for sending notifications</span>
<span class="k">class</span><span class="w"> </span><span class="nc">NotificationService</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Dependencies of the class</span>
<span class="w">    </span><span class="n">IEMailSender</span><span class="w"> </span><span class="n">_emailSender</span><span class="p">;</span>
<span class="w">    </span><span class="n">ILogger</span><span class="w"> </span><span class="n">_logger</span><span class="p">;</span>
<span class="w">    </span><span class="n">IContactRepository</span><span class="w"> </span><span class="n">_contactRepository</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">NotificationService</span><span class="p">(</span><span class="n">ILogger</span><span class="w"> </span><span class="n">logger</span><span class="p">,</span><span class="w"> </span><span class="n">IEMailSender</span><span class="w"> </span><span class="n">emailSender</span><span class="p">,</span>
<span class="w">        </span><span class="n">IContactRepository</span><span class="w"> </span><span class="n">contactRepository</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">logger</span><span class="p">;</span>
<span class="w">        </span><span class="n">_emailSender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">emailSender</span><span class="p">;</span>
<span class="w">        </span><span class="n">_contactRepository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">contactRepository</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Sends an email notification to the contact with the given ID</span>
<span class="w">    </span><span class="c1">// (contactId is a key in the Contacts table)</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SendEmailReminder</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">contactId</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">todoMessage</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="n">emailTo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_contactRepository</span><span class="p">.</span><span class="n">GetContactEMailAddress</span><span class="p">(</span><span class="n">contactId</span><span class="p">);</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="n">emailSubject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"TODO reminder"</span><span class="p">;</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="n">emailMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Reminder about the following todo item: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">todoMessage</span><span class="p">;</span>
<span class="w">        </span><span class="n">_emailSender</span><span class="p">.</span><span class="n">SendMail</span><span class="p">(</span><span class="n">emailTo</span><span class="p">,</span><span class="w"> </span><span class="n">emailSubject</span><span class="p">,</span><span class="w"> </span><span class="n">emailMessage</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="cp">#region Contracts (abstractions)</span>

<span class="c1">// Interface for logging</span>
<span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">ILogger</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">void</span><span class="w"> </span><span class="nf">LogInformation</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">text</span><span class="p">);</span>
<span class="w">    </span><span class="k">void</span><span class="w"> </span><span class="nf">LogError</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">text</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Interface for sending e-mail</span>
<span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IEMailSender</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">void</span><span class="w"> </span><span class="nf">SendMail</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">subject</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">message</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Interface for Contact entity persistence</span>
<span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IContactRepository</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="nf">GetContactEMailAddress</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">contactId</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#endregion</span>

<span class="cp">#region Implementations</span>

<span class="c1">// Class for logging</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Logger</span><span class="p">:</span><span class="w"> </span><span class="n">ILogger</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">LogInformation</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* ...*/</span><span class="w">  </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">LogError</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="cm">/* ...*/</span><span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Class for sending e-mail</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">EMailSender</span><span class="p">:</span><span class="w"> </span><span class="n">IEMailSender</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">ILogger</span><span class="w"> </span><span class="n">_logger</span><span class="p">;</span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="n">_smtpAddress</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">EMailSender</span><span class="p">(</span><span class="n">ILogger</span><span class="w"> </span><span class="n">logger</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">smtpAddress</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">logger</span><span class="p">;</span>
<span class="w">        </span><span class="n">_smtpAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">smtpAddress</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SendMail</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">subject</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">message</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_logger</span><span class="p">.</span><span class="n">LogInformation</span><span class="p">(</span><span class="s">$"Sendding e-mail. To: {to} Subject: {subject} Body: {message}"</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Class for Contact entity persistence</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ContactRepository</span><span class="p">:</span><span class="w"> </span><span class="n">IContactRepository</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nf">GetContactEMailAddress</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">contactId</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>

<span class="cp">#endregion</span>
</code></pre></div>
<p>We improved out previous solution in the following points:</p>
<ul>
<li>The <code>NotificationService</code> class no longer instantiates its dependencies itself, but receives them in constructor parameters.</li>
<li>Interfaces (abstractions) have been introduced to manage dependencies</li>
<li>The <code>NotificationService</code> class gets its dependencies in the form of interfaces. When a class receives its dependencies externally (e.g. via constructor parameters), it is called <strong>DEPENDENCY INJECTION</strong> (DI).</li>
<li>In our case, the classes get their class dependencies in constructor parameters: this specific form of DI is called <strong>CONSTRUCTOR INJECTION</strong>. This is the most common - and most recommended - way to inject dependency. (Alternatively, for example, we could use property injection, which is based on a public property setter to set a specific dependency of a class).</li>
</ul>
<p>In our current solution, <code>NotificationService</code> dependencies are instantiated by the (direct) USER of the class (which is the <code>ToDoService</code> class). Primarily this is the reason why we are still facing with a few problems:</p>
<ol>
<li>The user of <code>NotificationService</code> objects, which is the <code>ToDoService</code> class, is still dependent on the implementation types (since it has to instantiate the <code>Logger</code>,<code>EMailSender</code> and <code>ContactRepository</code> classes).</li>
<li>If we use the <code>Logger</code>, <code>EMailSender</code> and <code>ContactRepository</code> classes at multiple places in your application, we must instantiate them explicitly. In other words: at each and every place where have to create an <code>ILogger</code>, <code>IEMailSender</code> or <code>IContactRepository</code> implementation class, we have to make a decision which implementation to choose. This is essentially a special case of code duplication, the decision should appear only once in our code.<ul>
<li>Our goal, in contrast, would be to determine <strong>at a single central location</strong> what type implementation to use for an abstraction (interface type) <strong>everywhere</strong> in the application (e.g. for <code>ILogger</code> create an <code>Logger</code> instance everywhere, for <code>IMailSender</code> create an <code>EMailSender</code> everywhere).</li>
<li>This would allow us to easily review our abstraction-to-implementation mappings at one place.</li>
<li>Moreover, if we want to change one of the mappings (e.g. using <code>AdvancedLogger</code> instead of <code>Logger</code> for <code>ILogger</code>) we could achieve that by making a single change at a central location.</li>
</ul>
</li>
</ol>
<h2 id="example-phase-3-dependency-injection-based-on-net-dependency-injection">Example phase 3 - dependency injection based on .NET Dependency Injection<a class="headerlink" href="#example-phase-3-dependency-injection-based-on-net-dependency-injection" title="Permanent link">¶</a></h2>
<p>We need some extra help from our framework to solve the two problems we concluded the previous chapter with: an <strong>Inversion of Control (IoC)</strong> container (also called as Dependency Injection container). <strong>Dependency Injection container</strong> is a widely used alternative name for the same tool/technique. In an IoC container we can store abstraction type -&gt; implementation type mappings, such as ILogger-&gt;Logger, IMailSender-&gt;EMailSender, etc. This is called the REGISTER step. And then based on these mappings create an implementation type for a specific abstraction type (e.g. <code>Logger</code> for an <code>ILogger</code>). This is called the RESOLVE step. In more detail:</p>
<ol>
<li><strong>REGISTER</strong>: Register dependency mappings (e.g. <code>ILogger</code>-&gt; <code>Logger</code>, <code>IMailSender</code>-&gt; <code>EMailSender</code>) into an IoC container, once, at a centralized location, at application startup. This is the <strong>REGISTER</strong> step of the DI process.</li>
<li>Note: This solves "problem 2" pointed out at the end of the previous chapter: the mappings are centralized, and not scattered all over the application code base.</li>
<li><strong>RESOLVE</strong>: When we need an implementation object at runtime in our application, we ask the container for an implementation by specifying the abstraction (interface) type (e.g., by providing <code>ILogger</code> as a key, the container returns an object of class <code>Logger</code>).<ul>
<li>The resolve step is typically done at the "<strong>entry point</strong>" of the application (e.g. in case of WebApi on the receival of web requests, we will look into this later). The <strong>resolve step is performed only for the ROOT OBJECT</strong> (e.g. for the appropriate Controller class in case of WebApi). The container creates and returns a root object and all its dependencies and all its indirect dependencies: an entire object graph is generated. This process is called <strong>AUTOWIRING</strong>.</li>
<li>Note: In case of Web API calls, the Resolve step is executed by the Asp.Net framework and is mostly hidden from the developer: all we see is that our controller class is automatically instantiated and all constructor parameters are automatically populated (with the help of the IoC container based on the mappings of the REGISTER step).</li>
</ul>
</li>
</ol>
<p>Fortunately, .NET has a built in IoC container based dependency injection service.
Now we elucidate and illustrate the complete mechanism (register and resolve steps) using our enhanced e-mail notification solution as an example.</p>
<h3 id="1-register-step-registering-dependencies">1) REGISTER step (registering dependencies)<a class="headerlink" href="#1-register-step-registering-dependencies" title="Permanent link">¶</a></h3>
<p>In an Asp.Net Core environment, dependencies are registered in the 'Program.cs' file. This file has code that is executed at application startup. The code parts located here and which are relevant for us:</p>
<div class="highlight"><pre><span></span><code><span class="kt">var</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WebApplication</span><span class="p">.</span><span class="n">CreateBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>

<span class="c1">// ...</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddSingleton</span><span class="o">&lt;</span><span class="n">ILogger</span><span class="p">,</span><span class="w"> </span><span class="n">Logger</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddTransient</span><span class="o">&lt;</span><span class="n">INotificationService</span><span class="p">,</span><span class="w"> </span><span class="n">NotificationService</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddScoped</span><span class="o">&lt;</span><span class="n">IContactRepository</span><span class="p">,</span><span class="w"> </span><span class="n">ContactRepository</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddSingleton</span><span class="o">&lt;</span><span class="n">IEMailSender</span><span class="p">,</span><span class="w"> </span><span class="n">EMailSender</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">    </span><span class="n">sp</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">EMailSender</span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">GetRequiredService</span><span class="o">&lt;</span><span class="n">ILogger</span><span class="o">&gt;</span><span class="p">(),</span><span class="w"> </span><span class="s">"smtp.myserver.com"</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="c1">// ...</span>
</code></pre></div>
<p>The first line creates a <code>builder</code> object, whose <code>Services</code> property is an object implementing the <code>IServiceCollection</code>  interface. This represents the IoC container created by the framework, this can be used to register our dependency mappings as well, namely the  <strong>AddSingleton</strong>, <strong>AddTransient</strong> and <strong>AddScoped</strong> operations of <code>IServiceCollection</code> interface can be used to register them.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In .NET versions prior to .NET 6 the instead of <code>Program.cs</code> the <code>ConfigureServices</code> operation of the <code>Startup</code> class was used to register these dependencies.</p>
</div>
<p>The</p>
<div class="highlight"><pre><span></span><code><span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddSingleton</span><span class="o">&lt;</span><span class="n">ILogger</span><span class="p">,</span><span class="w"> </span><span class="n">Logger</span><span class="o">&gt;</span><span class="p">();</span>
</code></pre></div>
<p>line registers an <code>ILogger</code>-&gt; <code>Logger</code> type mapping, and the <code>Logger</code> is registered as a singleton, as we used the <strong>AddSingleton</strong> operation for registration. This means that if we later ask the container for an <code>ILogger</code> object (provide <code>ILogger</code> as key at the resolve step), we will get a <code>Logger</code> object from the container, and always <strong>the same instance</strong>. The</p>
<div class="highlight"><pre><span></span><code><span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddTransient</span><span class="o">&lt;</span><span class="n">INotificationService</span><span class="p">,</span><span class="w"> </span><span class="n">NotificationService</span><span class="o">&gt;</span><span class="p">();</span>
</code></pre></div>
<p>line registers an <code>INotificationService</code>-&gt; <code>NotificationService</code> transient type mapping, as we used the <strong>AddTransient</strong> operation for registration. This means that if we later ask the container for an <code>INotificationService</code> object (provide <code>INotificationService</code> as key at the resolve step), we will get a <strong>separate newly created instance</strong> of <code>NotificationService</code> object from the container, for each query/resolve.</p>
<div class="highlight"><pre><span></span><code><span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddScoped</span><span class="o">&lt;</span><span class="n">IContactRepository</span><span class="p">,</span><span class="w"> </span><span class="n">ContactRepository</span><span class="o">&gt;</span><span class="p">();</span>
</code></pre></div>
<p>line registers an <code>IContactRepository</code>-&gt; <code>ContactRepository</code> scoped type mapping, as we used the <strong>AddScoped</strong> operation for registration. This means that if we later ask the container for an <code>IContactRepository</code> object (provide <code>IContactRepository</code> as key at the resolve step), we will get a <code>NotificationService</code> object, which will be the  <strong>same instance for the same scope</strong>, and a different instance for different scopes. For a Web API based application one web request is handled within one scope. Consequently, we receive the same instance of a class turning to the container multiple times within the same web request, but different ones when the web requests are different.</p>
<p>We can see additional registrations in the sample application, which we will return to later.</p>
<h3 id="2-resolve-step-resolving-dependencies">2) RESOLVE step (resolving dependencies)<a class="headerlink" href="#2-resolve-step-resolving-dependencies" title="Permanent link">¶</a></h3>
<h4 id="the-basics">The basics<a class="headerlink" href="#the-basics" title="Permanent link">¶</a></h4>
<p>Let's sum up where we are now: we have our abstraction to implementation type mappings registered into the ASP.NET Core IoC container at application startup. Our mappings are the following:</p>
<ul>
<li>ILogger -&gt; Logger as singleton</li>
<li>INotificationService -&gt; NotificationService as transient</li>
<li>IContactRepository -&gt; ContactRepository as scoped</li>
<li>IEMailSender -&gt; EMailSender as singleton</li>
</ul>
<p>From now on, whenever we need an instance of an implementation type for an abstraction, we can ask the container for it using the abstraction type as the key. How do we specifically do it in a .NET Core application? .NET Core provides an <code>IServiceProvider</code> reference to us, and we can use different forms of the <code>GetService</code> operation of this interface. E.g.:</p>
<div class="highlight"><pre><span></span><code><span class="k">void</span><span class="w"> </span><span class="nf">SimpleResolve</span><span class="p">(</span><span class="n">IServiceProvider</span><span class="w"> </span><span class="n">sp</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Returns an instance of the Logger class, as we have</span>
<span class="w">    </span><span class="c1">// registered the Logger implementation type for our ILogger abstraction.</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">logger1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sp</span><span class="p">.</span><span class="n">GetService</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">ILogger</span><span class="p">));</span>

<span class="w">    </span><span class="c1">// Same as the previous example. The difference is that we have provided</span>
<span class="w">    </span><span class="c1">// the type as a generic parameter. This is a more convenient approach.</span>
<span class="w">    </span><span class="c1">// To use this we have to import the Microsoft.Extensions.DependencyInjection</span>
<span class="w">    </span><span class="c1">// namespace via the using statement.</span>
<span class="w">    </span><span class="c1">// Returns an instance of the Logger class, see explanation above.</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">logger2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sp</span><span class="p">.</span><span class="n">GetService</span><span class="o">&lt;</span><span class="n">ILogger</span><span class="o">&gt;</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// GetService returns null if no type mapping is found for the specific type (ILogger)</span>
<span class="w">    </span><span class="c1">// GetRequiredService throws an exception instead.</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">logger3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sp</span><span class="p">.</span><span class="n">GetRequiredService</span><span class="o">&lt;</span><span class="n">ILogger</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p>In the above example, code comments explain the behavior in detail. In each case, an abstraction type is to be provided for the <code>GetService</code>/<code>GetRequiredService</code> operation (either via the <code>typeof</code> operator, or via a generic parameter), and the operation returns with an instance of an implementation type based on the type mappings registered in the container.</p>
<h4 id="object-graph-resolution-autowiring">Object graph resolution, autowiring<a class="headerlink" href="#object-graph-resolution-autowiring" title="Permanent link">¶</a></h4>
<p>In the previous example, the container was able to instantiate the <code>Logger</code> class at the resolve step without any major 'headaches', since it has no additional dependencies: it has a single default constructor. Now consider the resolution of <code>INotificationService</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ObjectGraphResolve</span><span class="p">(</span><span class="n">IServiceProvider</span><span class="w"> </span><span class="n">sp</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">notifService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sp</span><span class="p">.</span><span class="n">GetService</span><span class="o">&lt;</span><span class="n">INotificationService</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p>At the resolve step (GetService call), the container must create a <code>NotificationService</code> object. In doing so, it has to provide valid values for its constructor parameters, which actually means that has to resolve the class's direct and indirect dependencies, recursively:</p>
<ul>
<li>The NotificationService class has a three-parameter constructor (that is, it has three dependencies): <code>NotificationService (ILogger logger, IEMailSender emailSender, IContactRepository contactRepository)</code>. The <code>GetService</code> resolves constructor parameters one by one based on IoC container mapping registrations:<ul>
<li><code>ILogger</code> logger: a <code>Logger</code> object is provided by the container, always the same instance (as ILogger-&gt;Logger mapping is registered as singleton)</li>
<li><code>IEMailSender</code> emailSender: an <code>EMailSender</code> object is provided by the container, a different instance in each case (as mapping is registered as transient)<ul>
<li>The <code>EMailSender</code> constructor has an <code>ILogger logger</code> parameter, that has to be resolved as well: a <code>Logger</code> object is provided by the container, always the same instance (as registered as singleton)</li>
</ul>
</li>
<li><code>IContactRepository</code> contactRepository: a <code>ContactRepository</code> object is provided by the container, a different instance for different scopes (Web API e.g. for different Web API calls), as mapping is registered as scoped.</li>
</ul>
</li>
</ul>
<p>Summing up: the <code>GetService&lt;INotificationService&gt;()</code> call above creates a fully parameterized <code>NotificationService</code> object with all of its direct and indirect dependencies, the call returns an <strong>object graph</strong> for us:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/object-graph-2.svg" data-desc-position="bottom"><img alt="Object graph 2" src="images/object-graph-2.svg"></a></p>
<p>As we have seen in this example, IoC containers/DI frameworks are capable of determining the dependency requirements of objects (by examining at their constructor parameters), and then creating entire object graphs based on upfront abstraction-&gt;implementation container type mappings. This process is called <strong>autowiring</strong>.</p>
<h4 id="dependency-resolution-for-aspnet-web-api-classes">Dependency resolution  for ASP.NET Web API classes<a class="headerlink" href="#dependency-resolution-for-aspnet-web-api-classes" title="Permanent link">¶</a></h4>
<p>Besides making our solution IoC container based, we make a few further changes to our todo app. We eliminate our <code>ToDoService</code> class, and move its functionality in a slightly different form into  an Asp.Net Core based <code>ControllerBase</code> derived class. This controller class will serve as our entry point and also as a root object, bringing our solution very close to a real life example (let it be a Web API, Web MVC app or a Web Razor Pages app). We could also have kept <code>ToDoService</code> in the middle of our call/dependency chain, but we try to keep things as simple as possible for our demonstration purposes. Furthermore, we also introduce an Entity Framework <code>DbContext</code> derived class called <code>TodoContext</code> to be able to demonstrate how it can be injected into repository classes in a typical application. Our new object graph will look like this:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/object-graph-3.svg" data-desc-position="bottom"><img alt="Object graph 3" src="images/object-graph-3.svg"></a></p>
<p>In the previous two chapters, we have assumed that a <code>IServiceProvider</code> object is available to call <code>GetService</code>. If we create a container ourselves, then this assumption is valid. However, only in the rarest cases do we create a container directly. In a typical ASP.NET Web API application, the container is created by the framework and is not directly accessible to us. Consequently, access to `IServiceProvider ', with the exception of a few startup and configuration points, is not available. The good news is that actually we don't need access to the container. <strong>The core concept of DI is that we perform dependency resolution only at the application entry point for the "root object".</strong> In case of Web API apps, the entry point is a call to an operation of a Controller class serving the specific API request. When a request is received, the framework determines and creates the Controller / ControllerBase child class based on the Url and routing rules. If the controller class has dependencies (has constructor parameters), they are also resolved based on the container registration mappings, including indirect dependencies. The complete object graph is created, <strong>the root object is the controller class</strong>.</p>
<p>Let's take a look at this in practice by refining our previous example with the addition of a <code>TodoController</code> class:</p>
<div class="highlight"><pre><span></span><code><span class="na">[Route("api/[controller]</span><span class="s">")]</span>
<span class="na">[ApiController]</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">TodoController</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ControllerBase</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Dependencies of the TodoController class</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">TodoContext</span><span class="w"> </span><span class="n">_context</span><span class="p">;</span><span class="w"> </span><span class="c1">// this is a DbContext</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">INotificationService</span><span class="w"> </span><span class="n">_notificationService</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Dependencies are received as constructor parameters</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">TodoController</span><span class="p">(</span><span class="n">TodoContext</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">INotificationService</span><span class="w"> </span><span class="n">notificationService</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">;</span>
<span class="w">        </span><span class="n">_notificationService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">notificationService</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// Fill wit some initial data</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="n">TodoItems</span><span class="p">.</span><span class="n">Count</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">_context</span><span class="p">.</span><span class="n">TodoItems</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">TodoItem</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Item1"</span><span class="w"> </span><span class="p">});</span>
<span class="w">            </span><span class="n">_context</span><span class="p">.</span><span class="n">TodoItems</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">TodoItem</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Item2"</span><span class="p">,</span><span class="w"> </span><span class="n">LinkedContactId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">});</span>
<span class="w">            </span><span class="n">_context</span><span class="p">.</span><span class="n">SaveChanges</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// API call handling function for sending an e-mail notification</span>
<span class="w">    </span><span class="c1">// Example for use: a http post request to this url (e.g. via using PostMan):</span>
<span class="w">    </span><span class="c1">//     http://localhost:58922/api/todo/2/reminder</span>
<span class="w">    </span><span class="c1">// , which sends an e-mail notif to the e-mail address appointed of the</span>
<span class="w">    </span><span class="c1">// contact person referenced by the todo item.</span>
<span class="w">    </span><span class="na">[HttpPost("{id}/reminder")]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">IActionResult</span><span class="w"> </span><span class="nf">ReminderMessageToLinkedContact</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">id</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Look up todo item</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_context</span><span class="p">.</span><span class="n">TodoItems</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nf">NotFound</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Rend reminder e-mail</span>
<span class="w">        </span><span class="n">_notificationService</span><span class="p">.</span><span class="n">SendEmailReminder</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">LinkedContactId</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Actually we don't create anything here, simply return an OK</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nf">Ok</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ... further operations</span>
<span class="p">}</span>
</code></pre></div>
<p>Requests under the <code>http://&lt;base_address&gt;/api/todo</code> url are routed to the <code>TodoController</code> class based on the routing rules. The mail sending request (<code>http://&lt;base_address&gt;/api/todo/&lt;todo-id&gt;/reminder</code>) is routed to its <code>TodoController.ReminderMessageToLinkedContact</code> operation. A <code>TodoController</code> object is instantiated by the framework, creating a new instance for each request. The <code>TodoController</code> class has two dependencies provided as constructor parameters. The first is a <code>TodoContext</code> object, which is a <code>DbContext</code> derived class. The other is an <code>INotificationService</code>, (which we already covered in our previous example). As we saw in the previous section, the DI framework can create these objects based on the container registered mappings (with all their indirect dependencies), and then pass them to the <code>TodoController</code> as constructor parameter, where they are stored in member variables. The entire object graph is created, with <code>TodoController</code> as the root object. This object graph is to serve the specific web API request.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The resolution of <code>TodoContext</code> is only possible if it's pre-registered in the IoC container. We will discuss this in the next chapter.</p>
</div>
<h2 id="entity-framework-dbcontext-container-registration-and-resolution">Entity Framework DbContext container registration and resolution<a class="headerlink" href="#entity-framework-dbcontext-container-registration-and-resolution" title="Permanent link">¶</a></h2>
<p>In applications, especially in Asp.Net Core based ones, there are two ways to use DbContext:</p>
<ul>
<li>Each time it is needed, we create and dispose it with the help of a using block. This can result in the creation of multiple DbContext instances serving an incoming request (which is absolutely OK).</li>
<li>We create one <code>DbContext</code>  for a specific incoming request and share it for the classes involved in serving the request. In this case, we think of the <code>DbContext</code> instance as a unit of work serving the request.</li>
</ul>
<p>To accomplish this latter approach, ASP.NET Core provides a handy built-in DI based solution: when we configure our container with the type mappings at startup, we also register our DbContext class, which is then later automatically injected for our <strong>Controller</strong> and other (typically repository) dependencies.</p>
<p>Let's see how our <code>TodoContext</code> (<code>DbContext</code> derived) class is registered in our example. The place of the registration is the usual <code>Program.cs</code> file (<code>Startup.ConfigureServices</code> for .NET versions prior to .NET 6):</p>
<div class="highlight"><pre><span></span><code><span class="c1">// ...</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddDbContext</span><span class="o">&lt;</span><span class="n">TodoContext</span><span class="o">&gt;</span><span class="p">(</span><span class="n">opt</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">opt</span><span class="p">.</span><span class="n">UseInMemoryDatabase</span><span class="p">(</span><span class="s">"TodoList"</span><span class="p">));</span>
<span class="c1">// ...</span>
</code></pre></div>
<p><code>AddDbContext</code> is an extension method defined by the framework for the <code>IServiceCollection</code> interface. This allows convenient registration of our <code>DbContext</code> class. We do not see into the implementation of <code>AddDbContext</code>, but actually it simply performs a scoped registration of our context type into the container:</p>
<div class="highlight"><pre><span></span><code><span class="n">services</span><span class="p">.</span><span class="n">AddScoped</span><span class="o">&lt;</span><span class="n">TodoContext</span><span class="p">,</span><span class="w"> </span><span class="n">TodoContext</span><span class="o">&gt;</span><span class="p">();</span>
</code></pre></div>
<p>As shown in the example, <code>TodoContext</code> <strong>is not registered via an abstraction</strong> (no <code>ITodoContext</code> interface exists) <strong>, but via the TodoContext implementation type itself. DI frameworks / IoC containers support the key part of a mapping to be a specific type, e.g. the implementation type itself</strong>. Use this approach only when justified, e.g. when we don't need extensibility for the specific type, and introducing an abstraction (interface) would only complicate the solution.</p>
<p>In an Asp.Net Core environment, we don't introduce an interface for our <code>DbContext</code> derived class: instead, we always register it with the type of its class to the IoC container (in our example <code>TodoContext</code>-&gt; <code>TodoContext</code> mapping). <code>DbContext</code> itself can work with many persistent providers (e.g. MSSQL, Oracle, in-memory, etc.), so in many cases it does not make sense to put it behind further abstractions. In those cases when we need to abstract data access, we do not introduce an interface to access <code>DbContext</code>. Instead, we use the Repository design pattern, and we introduce  interfaces for each repository implementations classes, and then register their mappings to the IoC container (e.g. <code>ITodoRepository</code>-&gt; <code>TodoRepository</code>). The repository classes either instantiate the <code>DbContext</code> objects themselves or the <code>DbContext</code> is injected as constructor parameter).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This document does not intend to make a standpoint over the often disputed question, whether it makes or does not make sense introducing a repository layer in an Entity Framework based application. For illustration purposes, our TodoApi application uses a mixed solution in this sense: controller/service classes use DbContext directly to persist TodoItem objects, and use the Repository pattern to handle Contacts. Don't mix the two approaches in a real-life application.</p>
</div>
<p>The example above also shows that you can also provide a lambda expression when registering <code>DbContext</code> (in case <code>TodoContext</code>) using <code>AddDbContext</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">opt</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">opt</span><span class="p">.</span><span class="n">UseInMemoryDatabase</span><span class="p">(</span><span class="s">"TodoList"</span><span class="p">)</span>
</code></pre></div>
<p>This lambda expression is called by the container later at the resolve step - that is, every time when a <code>TodoContext</code> is instantiated. An option object is provided as a parameter (in this example, the <code>opt</code> argument): this allows us to configurate the instance created by the container. In our example, calling the <code>UseInMemoryDatabase</code> operation creates an in-memory based database called "TodoList".</p>
<h2 id="advanced-dependency-injection-registration-example">Advanced dependency injection registration example<a class="headerlink" href="#advanced-dependency-injection-registration-example" title="Permanent link">¶</a></h2>
<div class="admonition note">
<p>Not compulsory material.</p>
</div>
<p>Let's cover code service registration related parts of <code>Program.cs</code> we skipped previously.</p>
<p>The registration of <code>EMailSender</code> looks quite tricky:</p>
<div class="highlight"><pre><span></span><code><span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddSingleton</span><span class="o">&lt;</span><span class="n">IEMailSender</span><span class="p">,</span><span class="w"> </span><span class="n">EMailSender</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">    </span><span class="n">sp</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">EMailSender</span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">GetRequiredService</span><span class="o">&lt;</span><span class="n">ILogger</span><span class="o">&gt;</span><span class="p">(),</span><span class="w"> </span><span class="s">"smtp.myserver.com"</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>
<p>Let's take a look at the constructor of <code>EMailSender</code> to be able to better understand the situation:</p>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="nf">EMailSender</span><span class="p">(</span><span class="n">ILogger</span><span class="w"> </span><span class="n">logger</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">smtpAddress</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">_logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">logger</span><span class="p">;</span>
<span class="w">    </span><span class="n">_smtpAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">smtpAddress</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><code>EMailSender</code> will need to be instantiated by the container when resolving <code>IEMailSender</code>, and the constructor parameters must be specified appropriately. The logger parameter is completely "OK", and the container can resolve it based on the ILogger-&gt; Logger container mapping registration. However, there is no way to find out the value of the <code>smtpAddress</code> parameter. To solve this problem, ASP.NET Core proposes an "options" mechanism for the framework, which allows us to retrieve the value from some configuration. Covering the "options" topic would be a far-reaching thread for us, so for simplification we applied another approach. The <code>AddSingleton</code> (and other Add ... operations) have an overload in which we can specify a lambda expression. This lambda is called by the container later at the resolve step (that is, when we ask the container for an <code>IEMailSender</code> implementation) for each instance. With the help of this lambda we manually create the <code>EMailSender</code> object, so we have the chance to provide the necessary constructor parameters. In fact, the container is really "helpful" with us:  it provides an <code>IServiceCollection</code> object as the lambda parameter for us (in this example it's called <code>sp</code>), and based on container registrations we can conveniently resolve types with the help of the already covered <code>GetRequiredService</code> and <code>GetService</code> calls.</p>
<h2 id="further-topics">Further topics<a class="headerlink" href="#further-topics" title="Permanent link">¶</a></h2>
<h3 id="dependency-injectionioc-containers-in-general">Dependency Injection/IoC containers in general<a class="headerlink" href="#dependency-injectionioc-containers-in-general" title="Permanent link">¶</a></h3>
<p>The particularities of the DI container built in ASP.NET Core:</p>
<ul>
<li>It provides basic services required by most applications (e.g., does not support property injection).<ul>
<li>If you need more DI related functionality, you can use another IoC container Asp.Net Core can work with.</li>
<li>Several Dependecy Injection / IoC container class libraries exist that can be used with .NET, with .NET Framework, or with both. A few examples: AutoFac, DryIoc, LightInject, Castle Windsor, Ninject, StructureMap, SimpleInjector, MEF, ...</li>
</ul>
</li>
<li>It's implemented in the <strong>Microsoft.Extensions.DependencyInjection</strong> NuGet package.<ul>
<li>For Asp.Net Core applications, it is automatically installed when the Asp.Net project is created. In fact, as we have seen, Asp.Net Core middleware heavily relies on it, it's a key pillar of runtime configuration and extensibility.</li>
<li>For other .NET applications (e.g. a simple .NET Core based console app), you need to add it manually by installing the Microsoft.Extensions.DependencyInjection NuGet package for the project.
&nbsp;&nbsp;  * Note: the NuGet package can be used with the (full) .NET Framework as well as it supports .NET Standard.</li>
</ul>
</li>
</ul>
<h3 id="the-service-locator-antipattern">The Service Locator antipattern<a class="headerlink" href="#the-service-locator-antipattern" title="Permanent link">¶</a></h3>
<p>Dependency injection is not the only way of using an IoC container. Another technique called <strong>Service Locator</strong> exists. Dependency Injection is based on the mechanism of passing the dependencies of a class as constructor parameters. Service Locator uses another approach: the classes directly access the IoC container in their methods to resolve their dependencies. Keep in mind that this approach is considered an <strong>anti-pattern</strong>. The reason is simple: every time time a class needs a dependency, it has to turn to a container, so much of our code will depend on the container itself! In contrast, when dependency injection is used, dependency resolution is performed "once" at the application entry point for "root objects" (e.g. for the controller class in case of a Web API call), the rest of our code is completely independent of the container. Note that in our previous example, in our TodoController, NotificationService, EMailSender, Logger, and ContactRepository classes, we did not refer the container (neither via an IServiceProvider, nor by any other means).</p>
<h3 id="aspnet-core-framework-services">Asp.Net Core framework services<a class="headerlink" href="#aspnet-core-framework-services" title="Permanent link">¶</a></h3>
<p>Asp.Net Core has several built in services. E.g. it has support for Web API, and support for Razor Pages or MVC based web applications. These all rely on the DI services of Asp.Net Core.</p>
<p>In case of an Asp.Net Web API application at application startup we have to run this piece of code (this is automatically added by VS at project creation):</p>
<div class="highlight"><pre><span></span><code><span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddControllers</span><span class="p">();</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In case of .NET version preceding .NET 6 <code>services.AddMvc()</code> had to be called from the <code>ConfigureServices</code> operation of our <code>Startup</code> class.</p>
</div>
<p><code>AddControllers</code> is a built in extension method for the <code>IServiceProvider</code> interface, which registers numerous (far more than 100!) service and configuration classes into the container required by the internals of the Web API middleware/pipeline.</p>
<h3 id="disposing-service-objects">Disposing service objects<a class="headerlink" href="#disposing-service-objects" title="Permanent link">¶</a></h3>
<p>The container calls <code>Dispose</code> for the objects it creates if the object implements the <code>IDisposable</code> interface.</p>
<h3 id="resources">Resources<a class="headerlink" href="#resources" title="Permanent link">¶</a></h3>
<ul>
<li><a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection">https://docs.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection</a></li>
<li><a href="https://stackify.com/net-core-dependency-injection/amp">https://stackify.com/net-core-dependency-injection/amp</a></li>
<li><a href="https://medium.com/volosoft/asp-net-core-dependency-injection-best-practices-tips-tricks-c6e9c67f9d96">https://medium.com/volosoft/asp-net-core-dependency-injection-best-practices-tips-tricks-c6e9c67f9d96</a></li>
</ul>

    <hr>
  <div class="md-source-file">
    <span class="md-source-file__fact"> <span class="md-icon" title="Last update"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z">
          </path>
        </svg>
      </span>
      <span title="November 8, 2025 23:39:23">
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="November 8, 2025 23:39:23 CET"><span class="timeago" datetime="2025-11-08T23:39:23+01:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="November 8, 2025 23:39:23 CET">2025-11-08</span>
      </span>
    </span>

    

    <span class="md-source-file__fact">
      <span class="md-icon" title="Szerzők">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z">
          </path>
        </svg>
      </span>
      <span>Contributors</span>
      <nav><a href="https://github.com/akosdudas" target="_blank" rel="noopener noreferrer" class="md-author" title="@Akos Dudas">
          <img src="https://avatars.githubusercontent.com/u/11335181?u=9971512094b94810046de53f5c1dee78e9776a4f&amp;v=4?size=72" alt="@Akos Dudas">
        </a><a href="https://github.com/bzolka" target="_blank" rel="noopener noreferrer" class="md-author" title="@Zoltán Benedek">
          <img src="https://avatars.githubusercontent.com/u/22932444?u=a3e164177137cbef68f0e72985785b0795ac7565&amp;v=4?size=72" alt="@Zoltán Benedek">
        </a><a href="https://github.com/Hameez1khan" target="_blank" rel="noopener noreferrer" class="md-author" title="@Muhammad Hameez Khan ">
          <img src="https://avatars.githubusercontent.com/u/96844641?u=5c3c4cd98c7b361e210c23e8959ab595e568de41&amp;v=4?size=72" alt="@Muhammad Hameez Khan ">
        </a><a href="https://github.com/tibitoth" target="_blank" rel="noopener noreferrer" class="md-author" title="@Tibor Tóth">
          <img src="https://avatars.githubusercontent.com/u/8333960?u=d26653213d265ecdceeaf20a896d74f479d35450&amp;v=4?size=72" alt="@Tibor Tóth">
        </a><a href="https://github.com/zbenedek-mirango" target="_blank" rel="noopener noreferrer" class="md-author" title="@Zoltán Benedek">
          <img src="https://avatars.githubusercontent.com/u/105201689?u=f025d5bedc2ea0cab45a1010194e95afd8ed3556&amp;v=4?size=72" alt="@Zoltán Benedek">
        </a></nav>      
    </span>
  </div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © BME VIK AUT
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.instant", "navigation.top", "search.suggest", "content.action.edit"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.6c14ae12.min.js"></script>
      
        <script src="../../js/timeago.min.js"></script>
      
        <script src="../../js/timeago_mkdocs_material.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>