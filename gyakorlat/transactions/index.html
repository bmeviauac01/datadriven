
<!doctype html>
<html lang="hu" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="Dudás Ákos">
      
      
      <link rel="icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.6">
    
    
      
        <title>Tranzakciókezelés - BMEVIAUAC01 Adatvezérelt rendszerek</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a57b2b03.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../extra-material-theme.css">
    
    
      


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="red" data-md-color-accent="red">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tranzakciokezeles" class="md-skip">
          Kihagyás
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Élőfej">
    <a href="../.." title="BMEVIAUAC01 Adatvezérelt rendszerek" class="md-header__button md-logo" aria-label="BMEVIAUAC01 Adatvezérelt rendszerek" data-md-component="logo">
      
  <img src="../../img/logo-bme-aut.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BMEVIAUAC01 Adatvezérelt rendszerek
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tranzakciókezelés
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="" data-md-color-primary="red" data-md-color-accent="red"  aria-label="Váltás sötét témára"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Váltás sötét témára" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent=""  aria-label="Váltás világos témára"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Váltás világos témára" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Keresés" placeholder="Keresés" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Törlés" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Keresés inicializálása
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/bmeviauac01/adatvezerelt/" title="Főoldalra ugrás" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    bmeviauac01/adatvezerelt
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Lapok" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Adatvezérelt rendszerek
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../db/" class="md-tabs__link">
        Adatbázis
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../jegyzet/architektura/" class="md-tabs__link">
        Jegyzetek
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="./" class="md-tabs__link md-tabs__link--active">
        Gyakorlatok
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../hazi/" class="md-tabs__link">
        Házi feladatok
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigáció" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="BMEVIAUAC01 Adatvezérelt rendszerek" class="md-nav__button md-logo" aria-label="BMEVIAUAC01 Adatvezérelt rendszerek" data-md-component="logo">
      
  <img src="../../img/logo-bme-aut.png" alt="logo">

    </a>
    BMEVIAUAC01 Adatvezérelt rendszerek
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/bmeviauac01/adatvezerelt/" title="Főoldalra ugrás" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    bmeviauac01/adatvezerelt
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Adatvezérelt rendszerek
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Adatbázis
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Adatbázis" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Adatbázis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../db/" class="md-nav__link">
        Minta adatbázis sémája
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../db/mssql/" class="md-nav__link">
        Microsoft SQL Server használata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../db/mongodb/" class="md-nav__link">
        MongoDB használata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://raw.githubusercontent.com/bmeviauac01/adatvezerelt/master/docs/db/mssql.sql" class="md-nav__link">
        Minta adatbázis: mssql.sql
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://raw.githubusercontent.com/bmeviauac01/adatvezerelt/master/docs/db/mongo.js" class="md-nav__link">
        Minta adatbázis: mongo.js
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Jegyzetek
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Jegyzetek" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Jegyzetek
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../jegyzet/architektura/" class="md-nav__link">
        Adatvezérelt rendszerek és a többrétegű (háromrétegű) architektúra
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../jegyzet/transactions/" class="md-nav__link">
        Tranzakciókezelés adatbázisokban
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../jegyzet/mssql/sql/" class="md-nav__link">
        SQL nyelv, MSSQL platformfüggő SQL utasítások
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../jegyzet/mssql/server-side-programming/" class="md-nav__link">
        Microsoft SQL Server programozása
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../jegyzet/adonet/" class="md-nav__link">
        ADO.NET adatelérés
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../jegyzet/linq/" class="md-nav__link">
        LINQ: Language Integrated Query
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../jegyzet/ef/" class="md-nav__link">
        Kapcsolatok definiálása Entity Framework-ben
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../jegyzet/mongodb/" class="md-nav__link">
        MongoDB alapok, műveletek, és a MongoDB .NET Driver
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../jegyzet/di/" class="md-nav__link">
        Függőséginjektálás ASP.NET Core környezetben
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../jegyzet/async/" class="md-nav__link">
        Aszinkron kérések és DTO-k (példa WebAPI alkalmazás)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../jegyzet/openapi/" class="md-nav__link">
        OpenAPI 3 és a Swagger
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/bmeviauac01/rest-webapi-sample" class="md-nav__link">
        REST és WebAPI demó alkalmazás (GitHub)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/bmeviauac01/todoapi-di-sample" class="md-nav__link">
        ASP.NET Core DI demó alkalmazás (GitHub)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/bmeviauac01/threelayered-aspnetcore-sample" class="md-nav__link">
        Minta többrétegű webalkalmazás (GitHub)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Gyakorlatok
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Gyakorlatok" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Gyakorlatok
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Tranzakciókezelés
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Tranzakciókezelés
      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="Tartalomjegyzék">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#elofeltetelek" class="md-nav__link">
    Előfeltételek
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gyakorlat-menete" class="md-nav__link">
    Gyakorlat menete
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feladat-1-adatbazis-letrehozasa-ms-sql-serveren" class="md-nav__link">
    Feladat 1: Adatbázis létrehozása MS SQL Serveren
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feladat-2-parhuzamos-tranzakciok" class="md-nav__link">
    Feladat 2: Párhuzamos tranzakciók
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feladat-3-tranzakcio-inditasa-read-committed-izolacios-szint" class="md-nav__link">
    Feladat 3: Tranzakció indítása, read committed izolációs szint
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feladat-4-tranzakcio-megszakitasa-rollback-read-committed-izolacios-szinten" class="md-nav__link">
    Feladat 4: Tranzakció megszakítása (rollback) read committed izolációs szinten
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feladat-5-megrendeles-rogzitese-serializable-izolacios-szinten" class="md-nav__link">
    Feladat 5: Megrendelés rögzítése serializable izolációs szinten
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feladat-6-megrendeles-rogzitese-read-committed-izolacios-szinten" class="md-nav__link">
    Feladat 6: Megrendelés rögzítése read committed izolációs szinten
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feladat-7-manualis-zarolas" class="md-nav__link">
    Feladat 7: Manuális zárolás
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feladat-8-tabla-szintu-zarolas" class="md-nav__link">
    Feladat 8: Tábla szintű zárolás
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mssql/" class="md-nav__link">
        Microsoft SQL Server programozása
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ef/" class="md-nav__link">
        Entity Framework
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mongodb/" class="md-nav__link">
        MongoDB
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../jpa/" class="md-nav__link">
        JPA & Spring Data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rest/" class="md-nav__link">
        REST API & ASP.NET Web API
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Házi feladatok
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Házi feladatok" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Házi feladatok
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/" class="md-nav__link">
        Szorgalmi házi feladatok
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/mssql/" class="md-nav__link">
        Feladat: MSSQL szerveroldali programozás
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/adonet/" class="md-nav__link">
        Feladat: ADO.NET adatelérés
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/ef/" class="md-nav__link">
        Feladat: Entity Framework
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/mongodb/" class="md-nav__link">
        Feladat: MongoDB
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/rest/" class="md-nav__link">
        Feladat: REST API Web API technológiával
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/GitHub/" class="md-nav__link">
        Feladatok beadása (GitHub)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/GitHub-Actions/" class="md-nav__link">
        GitHub Actions ismertető
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/VisualStudio/" class="md-nav__link">
        Visual Studio & .NET SDK telepítése
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="Tartalomjegyzék">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#elofeltetelek" class="md-nav__link">
    Előfeltételek
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gyakorlat-menete" class="md-nav__link">
    Gyakorlat menete
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feladat-1-adatbazis-letrehozasa-ms-sql-serveren" class="md-nav__link">
    Feladat 1: Adatbázis létrehozása MS SQL Serveren
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feladat-2-parhuzamos-tranzakciok" class="md-nav__link">
    Feladat 2: Párhuzamos tranzakciók
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feladat-3-tranzakcio-inditasa-read-committed-izolacios-szint" class="md-nav__link">
    Feladat 3: Tranzakció indítása, read committed izolációs szint
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feladat-4-tranzakcio-megszakitasa-rollback-read-committed-izolacios-szinten" class="md-nav__link">
    Feladat 4: Tranzakció megszakítása (rollback) read committed izolációs szinten
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feladat-5-megrendeles-rogzitese-serializable-izolacios-szinten" class="md-nav__link">
    Feladat 5: Megrendelés rögzítése serializable izolációs szinten
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feladat-6-megrendeles-rogzitese-read-committed-izolacios-szinten" class="md-nav__link">
    Feladat 6: Megrendelés rögzítése read committed izolációs szinten
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feladat-7-manualis-zarolas" class="md-nav__link">
    Feladat 7: Manuális zárolás
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feladat-8-tabla-szintu-zarolas" class="md-nav__link">
    Feladat 8: Tábla szintű zárolás
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/bmeviauac01/adatvezerelt/edit/master/docs/gyakorlat/transactions/index.md" title="Oldal szerkesztése" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="tranzakciokezeles">Tranzakciókezelés<a class="headerlink" href="#tranzakciokezeles" title="Permanent link">&para;</a></h1>
<p>A gyakorlat célja a relációs adatbázisok és a Microsoft SQL Server tranzakciókezelésének megismerése, a <em>serializable</em> izolációs szint gyakorlati használhatóságának korlátai, egyedi adat egymásra hatások szabályozása read committed izolációs szinten.</p>
<h2 id="elofeltetelek">Előfeltételek<a class="headerlink" href="#elofeltetelek" title="Permanent link">&para;</a></h2>
<p>A labor elvégzéséhez szükséges eszközök:</p>
<ul>
<li>Microsoft SQL Server (LocalDB vagy Express edition)</li>
<li>SQL Server Management Studio</li>
<li>Adatbázis létrehozó script: <a href="https://raw.githubusercontent.com/bmeviauac01/adatvezerelt/master/docs/db/mssql.sql">mssql.sql</a></li>
</ul>
<p>Amit érdemes átnézned:</p>
<ul>
<li>Tranzakciók tulajdonságai, izolációs szintek</li>
<li><a href="../../db/mssql/">Microsoft SQL Server használata segédlet</a></li>
</ul>
<h2 id="gyakorlat-menete">Gyakorlat menete<a class="headerlink" href="#gyakorlat-menete" title="Permanent link">&para;</a></h2>
<p>A gyakorlat vezetett. A szoftverekkel történő megismerkedés után a gyakorlatvezető instrukciói alapján együtt kerülnek elvégzésre a feladatok. A tapasztalt viselkedésekre magyarázatot keresünk, és azt a csoport együtt megbeszéli.</p>
<div class="admonition info">
<p>A viselkedések magyarázatát röviden összefoglalja az útmutató is. Előbb azonban gondolkodjunk el magunk a kérdéseken!</p>
</div>
<h2 id="feladat-1-adatbazis-letrehozasa-ms-sql-serveren">Feladat 1: Adatbázis létrehozása MS SQL Serveren<a class="headerlink" href="#feladat-1-adatbazis-letrehozasa-ms-sql-serveren" title="Permanent link">&para;</a></h2>
<p>Első lépésként szükségünk lesz egy adatbázisra. Az adatbázis tipikusan egy központi kiszolgálón helyezkedik el, de fejlesztés közben sokszor a saját gépünkön fut. Mi ez utóbbi opciót választjuk.</p>
<ol>
<li>
<p>Kapcsolódjon a Microsoft SQL Serverhez SQL Server Management Studio Segítségével. Indítsa el az alkalmazást, és az alábbi adatokkal kapcsolódjon.</p>
<ul>
<li>Server name: <code>(localdb)\mssqllocaldb</code></li>
<li>Authentication: <code>Windows authentication</code></li>
</ul>
</li>
<li>
<p>Hozzon létre egy új adatbázist (ha még nem létezik), az adatbázis neve legyen a Neptun kódja: <em>Object Explorer</em>-ben Databases-en jobb kattintás, és <em>Create Database</em>.</p>
</li>
<li>
<p>Hozza létre a minta adatbázist a generáló script lefuttatásával. Nyisson egy új <em>Query</em> ablakot, másolja be a script tartalmát, és futtassa le. Ügyeljen az eszköztáron levő legördülő menüben a megfelelő adatbázis kiválasztására.</p>
<p><img alt="Adatbázis kiválasztása" src="images/sql-management-database-dropdown.png" /></p>
</li>
<li>
<p>Ellenőrizze, hogy létrejöttek-e a táblák. Ha a <em>Tables</em> mappa ki volt már nyitva, akkor frissíteni kell.</p>
<p><img alt="Adatbázis kiválasztása" src="images/sql-managment-tablak.png" />.</p>
</li>
</ol>
<h2 id="feladat-2-parhuzamos-tranzakciok">Feladat 2: Párhuzamos tranzakciók<a class="headerlink" href="#feladat-2-parhuzamos-tranzakciok" title="Permanent link">&para;</a></h2>
<p>Nyisson két Query ablakot párhuzamos tranzakciók szimulálásához a New Query gomb kétszeri megnyomásával. Érdemes az ablakokat egymás mellé tenni: a Query fül fejlécére jobb egérrel kattintva válasszuk a <em>New Vertical Tab Group</em> opciót:</p>
<p><img alt="Két tranzakció elhelyezése egymás mellé" src="images/sql-management-tab-group.png" /></p>
<p>Használja az alábbi ütemezést a parancsok végrehajtására. A T1 tranzakció a 4-es megrendelés státuszát ellenőrzi, míg a T2 tranzakció
megváltoztatja a státuszt csomagolváról szállítás alattira.</p>
<ol>
<li>
<p><strong>T1 tranzakció</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Listázzuk ki a megrendelés és a hozzá tartozó tételek státuszát</span>
<span class="k">select</span> <span class="n">s1</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">s2</span><span class="p">.</span><span class="n">Name</span>
<span class="k">from</span> <span class="p">[</span><span class="k">Order</span><span class="p">]</span> <span class="n">o</span><span class="p">,</span> <span class="n">OrderItem</span> <span class="n">oi</span><span class="p">,</span> <span class="n">Status</span> <span class="n">s1</span><span class="p">,</span> <span class="n">status</span> <span class="n">s2</span><span class="p">,</span> <span class="n">Product</span> <span class="n">p</span>
<span class="k">where</span> <span class="n">o</span><span class="p">.</span><span class="n">Id</span><span class="o">=</span><span class="n">oi</span><span class="p">.</span><span class="n">OrderID</span>
<span class="k">and</span> <span class="n">o</span><span class="p">.</span><span class="n">ID</span><span class="o">=</span><span class="mi">4</span>
<span class="k">and</span> <span class="n">o</span><span class="p">.</span><span class="n">StatusID</span><span class="o">=</span><span class="n">s1</span><span class="p">.</span><span class="n">ID</span>
<span class="k">and</span> <span class="n">oi</span><span class="p">.</span><span class="n">StatusID</span><span class="o">=</span><span class="n">s2</span><span class="p">.</span><span class="n">ID</span>
<span class="k">and</span> <span class="n">p</span><span class="p">.</span><span class="n">ID</span><span class="o">=</span><span class="n">oi</span><span class="p">.</span><span class="n">ProductID</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title"><code>[Order]</code></p>
<p>Az <code>[Order]</code> tábla nevében azért kell a szögletes zárójel, hogy jelezzük, tábla névről van szó, és nem az <code>order by</code> parancs kezdetéről.</p>
</div>
</li>
<li>
<p><strong>T2 tranzakció</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Állítsuk át a megrendelés állapotát</span>
<span class="k">update</span> <span class="p">[</span><span class="k">Order</span><span class="p">]</span>
<span class="k">set</span> <span class="n">StatusID</span><span class="o">=</span><span class="mi">4</span>
<span class="k">where</span> <span class="n">ID</span><span class="o">=</span><span class="mi">4</span>
</code></pre></div>
</li>
<li>
<p><strong>T1 tranzakció</strong>: első lépésben kiadott parancs megismételve</p>
</li>
<li>
<p><strong>T2 tranzakció</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Állítsuk át a megrendeléshez tartozó tételek állapotát</span>
<span class="k">update</span> <span class="n">OrderItem</span>
<span class="k">set</span> <span class="n">StatusID</span><span class="o">=</span><span class="mi">4</span>
<span class="k">where</span> <span class="n">OrderID</span><span class="o">=</span><span class="mi">4</span>
</code></pre></div>
</li>
<li>
<p><strong>T1 tranzakció</strong>: első lépésben kiadott parancs megismételve</p>
</li>
</ol>
<details class="question"><summary>Mit tapasztalt? Miért?</summary><p>Kezdetben minden tétel "Packaged" státuszban van, ami így konzisztens (nem lehet egy darab tétel "in transit", azaz postázás alatt, ha a megrendelés nincs). Viszont, amint változatunk a megrendelés állapotán, a csomag státusza ellentmondásosnak látszik a tételek státuszával. Az adatbázis <strong>nem</strong> inkonzisztens, mert a belső szabályai (integritási kritériumai) alapján nincs probléma. De üzleti értelemben ellentmondásos a tartalom.</p>
<p>Az SQL Server alapértelmezésben auto commit üzemmódban fut, azaz egy utasítás az egy tranzakció, amit automatikusan lezár. Tehát a probléma, hogy a módosításaink nem egy tranzakciót képeznek.</p>
<p>A helyes viselkedéshez össze kellene fogni a két adatmódosító utasítást egy tranzakcióba.</p>
</details>
<h2 id="feladat-3-tranzakcio-inditasa-read-committed-izolacios-szint">Feladat 3: Tranzakció indítása, <em>read committed</em> izolációs szint<a class="headerlink" href="#feladat-3-tranzakcio-inditasa-read-committed-izolacios-szint" title="Permanent link">&para;</a></h2>
<p>Ismételje meg az előző feladatot úgy, hogy a két adatmódosítás egy tranzakciót képezzen:</p>
<ul>
<li>A <strong>T2 tranzakció</strong> kezdjen egy <code>begin tran</code>, és végződjön egy <code>commit</code> utasítással.</li>
<li>Az adatmódosításnál a státuszt ezúttal 3-asra állítsuk (hogy érdemi változás legyen az adatokban).</li>
</ul>
<details class="question"><summary>Mit tapasztalt? Miért?</summary><p>Amint elkezdtük a státusz módosítását <strong>T2</strong>-ben, a lekérdező <strong>T1</strong>-es utasítás várni fog. Addig vár, amíg az adatmódosító tranzakció be nem fejeződik. Ez azért van, mert a <code>select</code> utasítás olvasási zárat akar elhelyezni, de másik tranzakció éppen módosítja az adott rekordot, így kizáró zárat helyezett el rajta.</p>
<p>Jegyezzük meg, hogy az alap izolációs szint, a <em>read committed</em> ezen a platformon azt jelenti, hogy módosítás alatt levő adat nem olvasható. Ez egy implementációs kérdés, az SQL szabvány ezt nem rögzíti. Más adatbázis platform viselkedhet máshogy is (pl. az Oracle Server biztosítja, hogy a rekordok commitált képe mindenképpen olvasható marad). Más izolációs szinten az MSSQL szerver is máshogy viselkedik, a <em>snapshot</em> izolációs szint használata esetén a módosítás megkezdése előtti változat olvasható.</p>
</details>
<h2 id="feladat-4-tranzakcio-megszakitasa-rollback-read-committed-izolacios-szinten">Feladat 4: Tranzakció megszakítása (<em>rollback</em>) <em>read committed</em> izolációs szinten<a class="headerlink" href="#feladat-4-tranzakcio-megszakitasa-rollback-read-committed-izolacios-szinten" title="Permanent link">&para;</a></h2>
<p>Kezdjük el lefuttatni az előző parancs sorozatot, a tranzakcióval együtt, de a módosító tranzakciót szakítsuk meg a közepén.</p>
<ol>
<li>
<p><strong>T1 tranzakció</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Listázzuk ki a megrendelés és a hozzá tartozó tételek státuszát</span>
<span class="k">select</span> <span class="n">s1</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">s2</span><span class="p">.</span><span class="n">Name</span>
<span class="k">from</span> <span class="p">[</span><span class="k">Order</span><span class="p">]</span> <span class="n">o</span><span class="p">,</span> <span class="n">OrderItem</span> <span class="n">oi</span><span class="p">,</span> <span class="n">Status</span> <span class="n">s1</span><span class="p">,</span> <span class="n">status</span> <span class="n">s2</span><span class="p">,</span> <span class="n">Product</span> <span class="n">p</span>
<span class="k">where</span> <span class="n">o</span><span class="p">.</span><span class="n">Id</span><span class="o">=</span><span class="n">oi</span><span class="p">.</span><span class="n">OrderID</span>
<span class="k">and</span> <span class="n">o</span><span class="p">.</span><span class="n">ID</span><span class="o">=</span><span class="mi">4</span>
<span class="k">and</span> <span class="n">o</span><span class="p">.</span><span class="n">StatusID</span><span class="o">=</span><span class="n">s1</span><span class="p">.</span><span class="n">ID</span>
<span class="k">and</span> <span class="n">oi</span><span class="p">.</span><span class="n">StatusID</span><span class="o">=</span><span class="n">s2</span><span class="p">.</span><span class="n">ID</span>
<span class="k">and</span> <span class="n">p</span><span class="p">.</span><span class="n">ID</span><span class="o">=</span><span class="n">oi</span><span class="p">.</span><span class="n">ProductID</span>
</code></pre></div>
</li>
<li>
<p><strong>T2 tranzakció</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Új tranzakciót kezdünk</span>
<span class="k">begin</span> <span class="n">tran</span>

<span class="c1">-- Állítsuk át a megrendelés állapotát</span>
<span class="k">update</span> <span class="p">[</span><span class="k">Order</span><span class="p">]</span>
<span class="k">set</span> <span class="n">StatusID</span><span class="o">=</span><span class="mi">4</span>
<span class="k">where</span> <span class="n">ID</span><span class="o">=</span><span class="mi">4</span>
</code></pre></div>
</li>
<li>
<p><strong>T1 tranzakció</strong>: első lépésben kiadott parancs megismételve</p>
</li>
<li>
<p><strong>T2 tranzakció</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Szakítsuk meg a tranzakciót</span>
<span class="k">rollback</span>
</code></pre></div>
</li>
</ol>
<details class="question"><summary>Mit tapasztalt? Miért?</summary><p>Az előzőekben tapasztaltakhoz hasonlóan a módosítás megkezdte után az olvasó utasítás várakozásra kényszerült. Amikor megszakítottuk a tranzakciót, akkor érkezett meg az eredmény. Mivel <em>read committed</em> izolációs szinten vagyunk, nem látjuk a módosítás alatt levő tartalmat. Amint a módosító tranzakció befejeződik, akár sikeres <code>commit</code>, akár <code>rollback</code> miatt, elérhetővé válnak a rekordok.</p>
<p>Vegyük észre, hogy pont elkerültük a piszkos olvasás problémáját. Ha a módosítás futása közben megjelent volna a félkész eredmény, a <code>rollback</code> miatt az a tranzakció érvénytelen adattal dolgozna tovább.</p>
</details>
<h2 id="feladat-5-megrendeles-rogzitese-serializable-izolacios-szinten">Feladat 5: Megrendelés rögzítése <em>serializable</em> izolációs szinten<a class="headerlink" href="#feladat-5-megrendeles-rogzitese-serializable-izolacios-szinten" title="Permanent link">&para;</a></h2>
<p>A feladat megkezdése előtt először is szakítsuk meg a félbemaradt tranzakciókat. Mindkét ablakban adjunk ki pár <code>rollback</code> utasítást az esetleg ottmaradt tranzakciók leállításához.</p>
<p>Legyen két párhuzamos tranzakciónk, melyek megrendelést rögzítenek. Egy termékre nem vehetünk fel több megrendelést, mint ami a raktárkészlet. Azért, hogy a tranzakciók egymásra hatását elkülönítsük, kapcsoljunk át <em>serializable</em> izolációs szintre.</p>
<ol>
<li>
<p><strong>T1 tranzakció</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">set</span> <span class="k">transaction</span> <span class="k">isolation</span> <span class="k">level</span> <span class="k">serializable</span>
<span class="k">begin</span> <span class="n">tran</span>

<span class="c1">-- Ellenőrizzük, hogy mennyi van raktáron egy termékből</span>
<span class="k">select</span> <span class="o">*</span>
<span class="k">from</span> <span class="n">Product</span>
<span class="k">where</span> <span class="n">ID</span><span class="o">=</span><span class="mi">2</span>
</code></pre></div>
</li>
<li>
<p><strong>T2 tranzakció</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">set</span> <span class="k">transaction</span> <span class="k">isolation</span> <span class="k">level</span> <span class="k">serializable</span>
<span class="k">begin</span> <span class="n">tran</span>

<span class="k">select</span> <span class="o">*</span>
<span class="k">from</span> <span class="n">Product</span>
<span class="k">where</span> <span class="n">ID</span><span class="o">=</span><span class="mi">2</span>
</code></pre></div>
</li>
<li>
<p><strong>T1 tranzakció</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Ellenőrizzük, hogy hány, még fel nem dolgozott megrendelés van erre a termékre</span>
<span class="k">select</span> <span class="k">sum</span><span class="p">(</span><span class="n">Amount</span><span class="p">)</span>
<span class="k">from</span> <span class="n">OrderItem</span>
<span class="k">where</span> <span class="n">ProductID</span><span class="o">=</span><span class="mi">2</span>
<span class="k">and</span> <span class="n">StatusID</span><span class="o">=</span><span class="mi">1</span>
</code></pre></div>
</li>
<li>
<p><strong>T2 tranzakció</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">select</span> <span class="k">sum</span><span class="p">(</span><span class="n">Amount</span><span class="p">)</span>
<span class="k">from</span> <span class="n">OrderItem</span>
<span class="k">where</span> <span class="n">ProductID</span><span class="o">=</span><span class="mi">2</span>
<span class="k">and</span> <span class="n">StatusID</span><span class="o">=</span><span class="mi">1</span>
</code></pre></div>
</li>
<li>
<p><strong>T1 tranzakció</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Mivel teljesíthető a megrendelés, rögzítsük</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">OrderItem</span><span class="p">(</span><span class="n">OrderID</span><span class="p">,</span><span class="n">ProductID</span><span class="p">,</span><span class="n">Amount</span><span class="p">,</span><span class="n">StatusID</span><span class="p">)</span>
<span class="k">values</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
</li>
<li>
<p><strong>T2 tranzakció</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">insert</span> <span class="k">into</span> <span class="n">OrderItem</span><span class="p">(</span><span class="n">OrderID</span><span class="p">,</span><span class="n">ProductID</span><span class="p">,</span><span class="n">Amount</span><span class="p">,</span><span class="n">StatusID</span><span class="p">)</span>
<span class="k">values</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
</li>
<li>
<p><strong>T1 tranzakció</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">commit</span>
</code></pre></div>
</li>
<li>
<p><strong>T2 tranzakció</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">commit</span>
</code></pre></div>
</li>
</ol>
<details class="question"><summary>Mit tapasztalt? Miért?</summary><p>Holtpont fog kialakulni, mivel a <em>serializable</em> izolációs szint miatt mindkét tranzakció megtiltja a megrendeléstétel tábla módosítását. A <code>select sum</code> miatt, és a megismételhető olvasás elvárás miatt a rekordokat olvasó zárral látja el a rendszer. Viszont így nem futhat le a másik tranzakcióban az <code>insert</code>, amely kizárólagos zárat igényelne. Ez mindkét tranzakció esetén azt jelenti, hogy a másik által fogott zárra vár.</p>
<p>A holtpont eredménye, hogy az egyik tranzakciót le fogja állítani a szerver. Ez elvárt és helyes működést eredményez, mivel megakadályozza, hogy a két tranzakció közt adat egymásrahatás legyen (így nem fordulhat elő, hogy több terméket adunk el, mint amennyi van).</p>
</details>
<p>Ismételjük meg a fenti műveletsort, csak a megrendelés rögzítésekor más-más termék ID-t használjunk! Ezzel azt szimuláljuk, hogy két megrendelő más-más terméket rendel meg.</p>
<ul>
<li>A feladat megkezdése előtt először is szakítsuk meg a félbemaradt tranzakciókat. Mindkét ablakban adjunk ki pár <code>rollback</code> utasítást az esetleg ottmaradt tranzakciók leállításához.</li>
<li>Ahol utasításban <code>ID</code> vagy <code>ProductID</code> szerepel, ott egyik tranzakcióban a 2-es, másikban a 3-as terméket használjuk.</li>
</ul>
<details class="question"><summary>Mit tapasztalt? Miért?</summary><p>Ha különböző termékre történik a rögzítés, akkor is holtpont fog kialakulni. Olyan a zárolási rendszer, hogy a <code>select sum</code> az egész táblát zárolja, mivel nem tudja megkülönböztetni <code>ProductID</code> szerint a rekordokat. Ez természetes is, mivel csak az üzleti logikából adódik, hogy ha két különböző termékre történik a megrendelés rögzítése, akkor azok történhetnének egyszerre is. Az adatbázis ezt nem tudhatja.</p>
<p>Azaz a <em>serializable</em> izolációs szint túl szigorú, üzleti logikát figyelembe véve nagyobb párhuzamosítás engedhető meg. Ezért is ritkán használjuk a gyakorlatban.</p>
</details>
<h2 id="feladat-6-megrendeles-rogzitese-read-committed-izolacios-szinten">Feladat 6: Megrendelés rögzítése <em>read committed</em> izolációs szinten<a class="headerlink" href="#feladat-6-megrendeles-rogzitese-read-committed-izolacios-szinten" title="Permanent link">&para;</a></h2>
<p>Gondoljuk végig, az előző feladat esetén mi történne, ha a nem állítjuk át a tranzakciók izolációs szintjét? Lenne holtpont? És helyes lenne a működés?</p>
<details class="question"><summary>Mit várunk? Miért?</summary><p>Ha nem változtatunk izolációs szintet, akkor helytelen működés állhatna elő. Mivel a <em>read committed</em> izolációs szint nem biztosítja számunkra azt, hogy amíg fut a tranzakciónk, addig egy másik tranzakció berögzítsen rekordokat. Tehát lefuthatna az <code>insert</code>, ami miatt végeredményben több árut adnánk el, mint ami a raktárban van. Ez a nem megismételhető olvasás problémája.</p>
<p>Erről az oldalról nézve tehát a <em>serializable</em> izolációs szint nem volt feleslegesen szigorú. Tényleg megvédett minket egy problémától.</p>
</details>
<h2 id="feladat-7-manualis-zarolas">Feladat 7: Manuális zárolás<a class="headerlink" href="#feladat-7-manualis-zarolas" title="Permanent link">&para;</a></h2>
<p>A feladat megkezdése előtt először is szakítsuk meg a félbemaradt tranzakciókat. Mindkét ablakban adjunk ki pár <code>rollback</code> utasítást az esetleg ottmaradt tranzakciók leállításához.</p>
<p>Read committed izolációs szintet használva dolgozzon ki megoldást, amely csak az <em>azonos termékekre</em> történő párhuzamos adatrögzítéseket akadályozza meg. Természetesen feltételezheti hogy mindegyik párhuzamos folyamat ugyanazt a programlogikát követi.</p>
<p>A megoldáshoz kihasználjuk, hogy lehetséges manuálisan zárakat elhelyezni. Ezek a zárak is, úgy, mint a többi zár, a tranzakció végéig élnek.</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span> <span class="o">*</span>
<span class="k">from</span> <span class="n">tablename</span> <span class="k">with</span><span class="p">(</span><span class="n">XLOCK</span><span class="p">)</span>
<span class="p">...</span>
</code></pre></div>
<details class="question"><summary>Hova kell ezt a zárat elhelyezni? Hogyan néz ki így a megrendelés folyamata?</summary><p>A megoldás kulcsa, hogy jó helyre tegyük a zárat. A kérdés, hogy mit is kellene zárolni? A válasz, hogy a <strong>terméket (Product)</strong>: azt akarjuk meggátolni, hogy ugyanabból a termékből rögzíthető legyen még egy eladás. Tehát a termékre, konkrétan a termék táblában arra a sorra tesszük a zárat, ami a terméket reprezentálja.</p>
<p>Ennek a megoldásnak a hátránya, hogy nagyon alaposan át kell gondolnunk, hogyan és hol végezzük a zárolást.</p>
<p>A lépéseink tehát a következők.</p>
<ol>
<li>
<p><strong>T1 tranzakció</strong></p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="k">set</span> <span class="k">transaction</span> <span class="k">isolation</span> <span class="k">level</span> <span class="k">read</span> <span class="k">committed</span>
</span><span class="k">begin</span> <span class="n">tran</span>

<span class="k">select</span> <span class="o">*</span>
<span class="hll"><span class="k">from</span> <span class="n">Product</span> <span class="k">with</span> <span class="p">(</span><span class="n">xlock</span><span class="p">)</span>
</span><span class="k">where</span> <span class="n">ID</span><span class="o">=</span><span class="mi">2</span>
</code></pre></div>
</li>
<li>
<p><strong>T2 tranzakció</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">set</span> <span class="k">transaction</span> <span class="k">isolation</span> <span class="k">level</span> <span class="k">read</span> <span class="k">committed</span>
<span class="k">begin</span> <span class="n">tran</span>

<span class="k">select</span> <span class="o">*</span>
<span class="k">from</span> <span class="n">Product</span> <span class="k">with</span> <span class="p">(</span><span class="n">xlock</span><span class="p">)</span>
<span class="hll"><span class="k">where</span> <span class="n">ID</span><span class="o">=</span><span class="mi">3</span>
</span></code></pre></div>
</li>
<li>
<p><strong>T1 tranzakció</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">select</span> <span class="k">sum</span><span class="p">(</span><span class="n">Amount</span><span class="p">)</span>
<span class="k">from</span> <span class="n">OrderItem</span>
<span class="k">where</span> <span class="n">ProductID</span><span class="o">=</span><span class="mi">2</span>
<span class="k">and</span> <span class="n">StatusID</span><span class="o">=</span><span class="mi">1</span>
</code></pre></div>
</li>
<li>
<p><strong>T2 tranzakció</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">select</span> <span class="k">sum</span><span class="p">(</span><span class="n">Amount</span><span class="p">)</span>
<span class="k">from</span> <span class="n">OrderItem</span>
<span class="hll"><span class="k">where</span> <span class="n">ProductID</span><span class="o">=</span><span class="mi">3</span>
</span><span class="k">and</span> <span class="n">StatusID</span><span class="o">=</span><span class="mi">1</span>
</code></pre></div>
</li>
<li>
<p><strong>T1 tranzakció</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">insert</span> <span class="k">into</span> <span class="n">OrderItem</span><span class="p">(</span><span class="n">OrderID</span><span class="p">,</span><span class="n">ProductID</span><span class="p">,</span><span class="n">Amount</span><span class="p">,</span><span class="n">StatusID</span><span class="p">)</span>
<span class="k">values</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
</li>
<li>
<p><strong>T2 tranzakció</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">insert</span> <span class="k">into</span> <span class="n">OrderItem</span><span class="p">(</span><span class="n">OrderID</span><span class="p">,</span><span class="n">ProductID</span><span class="p">,</span><span class="n">Amount</span><span class="p">,</span><span class="n">StatusID</span><span class="p">)</span>
<span class="hll"><span class="k">values</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span></code></pre></div>
</li>
<li>
<p><strong>T1 tranzakció</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">commit</span>
</code></pre></div>
</li>
<li>
<p><strong>T2 tranzakció</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">commit</span>
</code></pre></div>
</li>
</ol>
</details>
<h2 id="feladat-8-tabla-szintu-zarolas">Feladat 8: Tábla szintű zárolás<a class="headerlink" href="#feladat-8-tabla-szintu-zarolas" title="Permanent link">&para;</a></h2>
<p>A sor szintű zárolás mellett lehetőségünk van tábla szinten is zárolni:</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span> <span class="o">*</span>
<span class="k">from</span> <span class="n">tablanev</span> <span class="k">with</span><span class="p">(</span><span class="n">TABLOCKX</span><span class="p">)</span>
<span class="p">...</span>
</code></pre></div>
<details class="question"><summary>Bár ez egyszerű megoldásnak tűnik, gondoljuk végig, miért nem érdemes ezt használni?</summary><p>Jelen esetben a tábla szintű zárat a megrendelésekre kellene tennünk, hiszen a konkurens megrendeléseket akarjuk megakadályozni. De ez ugyanazzal az eredménnyel járna, mint a <em>serializable</em> izolációs szint használata. Ugyan holtpont nem lenne, de a párhuzamos végrehajtást lehetetlenné tenné. Tehát a tábla szintű zárolásra ugyanaz igaz: az üzleti logikából nagyobb párhuzamosság adódik.</p>
</details>
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Élőláb">
      
        
        <a href="../../jegyzet/openapi/" class="md-footer__link md-footer__link--prev" aria-label="Előző: OpenAPI 3 és a Swagger" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Előző
              </span>
              OpenAPI 3 és a Swagger
            </div>
          </div>
        </a>
      
      
        
        <a href="../mssql/" class="md-footer__link md-footer__link--next" aria-label="Következő: Microsoft SQL Server programozása" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Következő
              </span>
              Microsoft SQL Server programozása
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; BME VIK AUT
          </div>
        
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.instant", "navigation.top", "search.suggest"], "translations": {"clipboard.copy": "M\u00e1sol\u00e1s v\u00e1g\u00f3lapra", "clipboard.copied": "V\u00e1g\u00f3lapra m\u00e1solva", "search.config.lang": "hu", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Keres\u00e9s", "search.result.placeholder": "Keres\u00e9shez \u00edrj ide valamit", "search.result.none": "Nincs tal\u00e1lat", "search.result.one": "1 egyez\u0151 dokumentum", "search.result.other": "# egyez\u0151 dokumentum", "search.result.more.one": "1 tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.more.other": "# tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.term.missing": "\u00dcres", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.fcfe8b6d.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.b1047164.min.js"></script>
      
    
  </body>
</html>